---
layout: post
title:  "Python packaging and repo best practices"
categories: [blog, travel]
tags: [engineering]
# d3: True
---

What we need to make a good python library / project great. 
<!--more-->

1. CI
2. static code analyse
3. python typings
4. repo structure
5. badges
6. autogenerated docs and examples
7. tests -> code coverage 
8. jupyter notebooks + binder examples ?
9. packaging 
   1.  setup.py 
   2.  distutils + setuptools 
   3.  pip
   4.  conda 
   5.  pypy? 
10. platforms badge
11. license badge 
12. CONTRIBUTION ENCOURAGEMENT 
    1.  issue template 
    2.  merge request checks and templates
    3.  discussion forums
13. GIT WORKFLOW
14. DOCKER 
15. REQUIREMENTS / CONDA ENV ?
16. BLACK  https://www.mattlayman.com/blog/2018/python-code-black/
17. .pycache
18. PyUp
19. Coveralls https://coveralls.io/
20. PYLINT
21. AUTOPEP8 
22. .pycache
23. PyUp
24. 

# Project layout 

Directories:
- docs
- PROJECT_NAME
- test
Files:
- LICENSE
- README.md
- TODO.md
- setup.py
- 

# Setup tools 


# Git-flow 

![gitflow-image]()

http://nvie.com/posts/a-successful-git-branching-model/

1. `develop` - most work , code for next release
2. `feature` - non-trivial features / fixes, merge to `develop`
3. `master` - always production ready, updates done only throught creation of `release`

```
git flow init 
```

```
git flow feature start <feature name>
```

```
git flow feature finish <feature name>
```

```
git flow release start <release number>
```
allow to make bug fixes into `release/<release number>`

```
git flow release finish <release number>
```
merge all bug-fixes into `develop` and `master`

`hotfixes`
```
git flow hotfix start <release number>
git flow hotfix finish <release number>
```

# virtualenv  and conda environments 

```
echo "source /usr/local/bin/virtualenvwrapper.sh" >> ~/.zshrc

mkvirtualenv ossproject
pip install ...
deactivate 

workon ossproject
pip freeze > requirements.txt
```

conda environments are better because they are compatible with virtualenv and have additional features 
can manage non-python dependencies, don't use symlinks

```
conda create -n ossproject python=3.7 numpy
```

```
 conda activate ossproject
 ```

```
conda list --export > requirements.txt
```

# Testing 

## unittest

## py.test 

```
test/test_<project_name>.py

```

`coverage`  http://nedbatchelder.com/code/coverage/ 

```
pip install pytest-cov

py.test --cov=path/to/package --cov-report=term --cov-report=html
```

python -m pytest
python -m pytest --cov=. --cov-report=term --cov-report=html

will add current directory to path


## nose 


## Test multiple python versions 

http://tox.readthedocs.org/en/latest/

```
# content of: tox.ini , put in same dir as setup.py
[tox]
envlist = py36,py37
[testenv]
deps=pytest       # install pytest in the venvs
commands=py.test  # or 'nosetests' or ...
```

```
tox
```

For more elaborated version of `tox` config go to [#link1]

# Documentation `Sphinx`


# Cheesecake 


pip install cheesecake

python cheesecake_index --name=Durus

!read tutorial on PyPi.org https://packaging.python.org/

```
python setup.py sdist bdist_wheel

python3 -m twine upload --repository-url https://test.pypi.org/legacy/ dist/* --verbose
pip install -i https://test.pypi.org/simple/ adossproject==0.0.1
```

# Travis CI 

is it best solution for github ??? alternatives : 

*Continuous Integration* - process of continiously integrating all changes to a project. 

push -> test 

1. create account http://www.travis-ci.org/
2. `.travis.yml`
    1. project language
    2. language version
    3. install commands
    4. run test commands
3. 

Links:

1. Open Sourcing a Python Project the Right Way https://jeffknupp.com/blog/2013/08/16/open-sourcing-a-python-project-the-right-way/
2. `Cookiecutter` Python package template https://github.com/audreyr/cookiecutter-pypackage
3. 10 Steps to Set Up Your Python Project for Success https://towardsdatascience.com/10-steps-to-set-up-your-python-project-for-success-14ff88b5d13
4. `Cookiecutter` for other languages https://github.com/cookiecutter/cookiecutter
5. Build Your First Oppen Source Python Project https://towardsdatascience.com/build-your-first-open-source-python-project-53471c9942a7
6. 
